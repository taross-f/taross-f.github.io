---
tags: mysql

---

* DDL DMLともに別Databaseにまるっと全消し上書きでコピーしたい。
* なんども行うのでスクリプトにしたい。
* わざわざDBに入らなくてもよくしたい
* windows環境で動くようにしたい
* mysql clientは入ってる前提

## スクリプト

```bat

mysql -h <host> -u <UserId> -p<password>  -e"DROP DATABASE <移行先db>;CREATE DATABASE <移行先db> CHARACTER SET utf8;" 
mysqldump.exe --default-character-set=binary -h <host> -u <UserId> --add-drop-table -p<password> <db> > dump.sql 
mysql -h <host> -u <UserId> -p<password> --default-character-set=binary <移行先db>  < dump.sql


```

前提として`mysql`, `mysqldump`が入ってないと動かない

## ハマったところ

* 基本的に文字コードがやっかい(DBの文字コードはutf8にしている)
   * 影響でないようにBinaryでexport/importする。
* はじめpowershellでやろうとしてたけど、Powershell側で処理した時点で文字列がUTF-16になって、これまた文字コードが厄介
    *  cmd.exeを使う。苦肉
