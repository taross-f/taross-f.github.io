<!DOCTYPE html>
<html>
<head>
    <title>I18n Debug Test</title>
    <script>
      // Ë®ÄË™û„Éá„Éº„Çø„ÇíÊ®°Êì¨
      window.i18nData = {
        "ja": {
          "nav": {
            "blog": "Blog",
            "profile": "Profile",
            "apps": "Apps",
            "tags": "Tags"
          },
          "apps": {
            "text_tools": "üìù „ÉÜ„Ç≠„Çπ„Éà„ÉÑ„Éº„É´"
          }
        },
        "en": {
          "nav": {
            "blog": "Blog",
            "profile": "Profile", 
            "apps": "Apps",
            "tags": "Tags"
          },
          "apps": {
            "text_tools": "üìù Text Tools"
          }
        }
      };
    </script>
</head>
<body>
    <h1>I18n Debug Test</h1>
    
    <div>
        <h2>Browser Language Detection:</h2>
        <p>navigator.languages: <span id="languages"></span></p>
        <p>navigator.language: <span id="language"></span></p>
        <p>Detected language: <span id="detected"></span></p>
        <p>LocalStorage: <span id="localstorage"></span></p>
    </div>

    <div>
        <h2>Test Elements:</h2>
        <nav>
            <span data-i18n="nav.apps">Apps</span> | 
            <span data-i18n="apps.text_tools">üìù „ÉÜ„Ç≠„Çπ„Éà„ÉÑ„Éº„É´</span>
        </nav>
    </div>

    <div>
        <h2>Manual Controls:</h2>
        <button onclick="testEnglish()">Test English</button>
        <button onclick="testJapanese()">Test Japanese</button>
        <button onclick="clearStorage()">Clear Storage</button>
        <button onclick="debugInfo()">Show Debug Info</button>
    </div>

    <script>
      // Ëá™ÂãïË®ÄË™ûÊ§úÂá∫Ê©üËÉΩÔºà„Ç≥„Éî„ÉºÔºâ
      class AutoLanguageDetector {
        constructor() {
          this.supportedLanguages = ['ja', 'en'];
          this.defaultLanguage = 'ja';
          this.currentLang = this.detectLanguage();
          this.init();
        }

        init() {
          document.addEventListener('DOMContentLoaded', () => {
            this.applyLanguage(this.currentLang);
            this.showDebugInfo();
          });
        }

        detectLanguage() {
          // „Åæ„ÅölocalStorage„Çí„ÉÅ„Çß„ÉÉ„ÇØ
          const storedLang = localStorage.getItem('preferred-language');
          if (storedLang && this.supportedLanguages.includes(storedLang)) {
            return storedLang;
          }

          // „Éñ„É©„Ç¶„Ç∂„ÅÆË®ÄË™ûË®≠ÂÆö„ÇíÂèñÂæó
          const browserLangs = navigator.languages || [navigator.language || navigator.userLanguage];
          
          // „Éñ„É©„Ç¶„Ç∂„ÅÆË®ÄË™û„É™„Çπ„Éà„Åã„ÇâÂØæÂøúË®ÄË™û„ÇíÊ§úÂá∫
          for (const lang of browserLangs) {
            const primaryLang = lang.split('-')[0].toLowerCase();
            if (this.supportedLanguages.includes(primaryLang)) {
              localStorage.setItem('preferred-language', primaryLang);
              return primaryLang;
            }
          }
          
          // ÂØæÂøúË®ÄË™û„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„ÉàË®ÄË™û
          localStorage.setItem('preferred-language', this.defaultLanguage);
          return this.defaultLanguage;
        }

        applyLanguage(lang) {
          document.documentElement.lang = lang;
          
          // data-i18nÂ±ûÊÄß„ÇíÊåÅ„Å§Ë¶ÅÁ¥†„ÇíÊõ¥Êñ∞
          const elements = document.querySelectorAll('[data-i18n]');
          elements.forEach(element => {
            const key = element.dataset.i18n;
            const text = this.getTranslation(key, lang);
            if (text) {
              element.textContent = text;
            }
          });
          
          this.currentLang = lang;
          console.log(`Applied language: ${lang}`);
        }

        getTranslation(key, lang) {
          const keys = key.split('.');
          let result = window.i18nData[lang];
          
          for (const k of keys) {
            if (result && result[k]) {
              result = result[k];
            } else {
              console.warn(`Translation not found: ${key} for language ${lang}`);
              return null;
            }
          }
          
          return result;
        }

        showDebugInfo() {
          document.getElementById('languages').textContent = JSON.stringify(navigator.languages);
          document.getElementById('language').textContent = navigator.language;
          document.getElementById('detected').textContent = this.currentLang;
          document.getElementById('localstorage').textContent = localStorage.getItem('preferred-language');
        }

        getCurrentLanguage() {
          return this.currentLang;
        }
      }

      // Ëá™ÂãïË®ÄË™ûÊ§úÂá∫„ÅÆ„Ç§„É≥„Çπ„Çø„É≥„Çπ„Çí‰ΩúÊàê
      window.autoLanguageDetector = new AutoLanguageDetector();

      // „ÉÜ„Çπ„ÉàÈñ¢Êï∞
      function testEnglish() {
        window.autoLanguageDetector.applyLanguage('en');
        window.autoLanguageDetector.showDebugInfo();
      }

      function testJapanese() {
        window.autoLanguageDetector.applyLanguage('ja');
        window.autoLanguageDetector.showDebugInfo();
      }

      function clearStorage() {
        localStorage.removeItem('preferred-language');
        window.autoLanguageDetector.showDebugInfo();
        location.reload();
      }

      function debugInfo() {
        console.log('Debug Info:');
        console.log('navigator.languages:', navigator.languages);
        console.log('navigator.language:', navigator.language);
        console.log('localStorage:', localStorage.getItem('preferred-language'));
        console.log('current language:', window.autoLanguageDetector.getCurrentLanguage());
        console.log('i18nData:', window.i18nData);
      }
    </script>
</body>
</html>